#!/usr/bin/env node
process.chdir(__dirname);

var AddCmd = require('./lib/cmds/add'),
	RmCmd = require('./lib/cmds/rm'),
	ShowCmd = require('./lib/cmds/show'),
	git = require('./lib/git'),
	utils = require('./lib/utils');

var args = process.argv,
	cmd = args[2],
	otherArgs = args.splice(3, args.length);

utils.checkEnvVars();

switch(cmd){
	case 'add':
		new AddCmd(otherArgs, utils.errorHandler, function(exitCode){
			process.exit(exitCode);
		});
		break;

	case 'rm':
		new RmCmd(otherArgs, utils.errorHandler, function(exitCode){
			process.exit(exitCode);
		});
		break;

	case 'show':
		new ShowCmd(otherArgs, utils.errorHandler);
		process.exit(0);
		break;

	case 'pull':
		var statusCode = git.execSecretsCmd('git pull origin master');
		process.exit(statusCode);
		break;

	case 'push':
		var statusCode = git.execSecretsCmd('git add :/ && git commit -m "updates secrets.json" && git push origin master');
		process.exit(statusCode);
		break;

	case 'update':
		git.checkCliUpdate(utils.errorHandler, function(err){
			process.exit(0);
		});
		break;

	default:
		console.log('Usage: dsm [add | rm | show] [args...]');
		process.exit(0);
		break;
}