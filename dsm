#!/usr/bin/env node
process.chdir(__dirname);

var AddCmd = require('./lib/commands/add'),
	RmCmd = require('./lib/commands/rm'),
	ShowCmd = require('./lib/commands/show'),
	git = require('./lib/git');
	
var args = process.argv,
	cmd = args[2],
	otherArgs = args.splice(3, args.length);

var errorHandler = function(err){
	console.error(err.msg);
	process.exit(err.exitCode);
};

var checkCommand = function(){
	switch(cmd){
		case 'add':
			new AddCmd(otherArgs, errorHandler, function(exitCode){
				process.exit(exitCode);
			});
			break;

		case 'rm':
			new RmCmd(otherArgs, errorHandler);
			process.exit(0);
			break;

		case 'show':
			new ShowCmd(otherArgs, errorHandler);
			process.exit(0);
			break;

		case 'update':
			git.checkUpdate();
			process.exit(0);
			break;

		default:
			console.log('Usage: dsm [add | rm | show] [args...]');
			process.exit(0);
			break;
	}
};

checkCommand();